<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
	"http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head><!-- {{{ -->
		<meta http-equiv="Content-type" content="text/html; charset=utf-8">
		<title>opening_hours demo</title>
		<!-- Some CSS {{{ -->
		<style>
			body { font-family: sans-serif }
			table {}
			// tr.separator td { height: 2px; background: none }
			// tr.endweek td { border-bottom: 1px solid #BBBBCC; border-bottom-left-radius: 5px; border-bottom-right-radius: 5px }
			// tr.today td { border-top: 1px solid #BBBBCC; border-top-left-radius: 5px; border-top-right-radius: 5px }
			tr.today td.day { text-decoration: underline }
			td { background: #E0E0E0; padding: 0px 10px }
			td.day { text-align: center }
			td.workday { background: #CCFF99 }
			td.weekend { background: #FFCC99 }
			td.times { width: 400px; padding: 0px 1px }

			div.timebar { height: 20px; display: inline-block }
			div.open { background: #FFFFFF; margin: 0px -1px; border: 1px solid #AAAAAA; border-radius: 5px }
			div.unknown { background: #94d7b3; margin: 0px -1px; border: 1px solid #AAAAAA; border-radius: 5px }
			div.closed {}
			p.open { color: #44AA00 }
			p.unknown { color: #94d7b3 }
			p.closed { color: #AA4400 }
		</style>
		<!-- }}} -->
		<!-- Javascript {{{ -->
		<!-- <script type="text/javascript" src="js/jquery&#45;1.10.2.min.js"></script> -->
		<script type="text/javascript" src="node_modules/suncalc/suncalc.js"></script>
		<script type="text/javascript" src="opening_hours.js"></script>
		<script type="text/javascript" src="js/i18next-1.6.3.min.js"></script>
		<script type="text/javascript">
			// localization {{{
			var resources = { // English is fallback language.
				en: { translation: {
						"lang": {
							"en": "English",
							"de": "German",
							"ru": "Russian",
							"choose": "Choose Language",
						},
						"months": {
							"short": {
								"jan": "Jan",
								"feb": "Feb",
								"mar": "Mar",
								"apr": "Apr",
								"may": "May",
								"jun": "Jun",
								"jul": "Jul",
								"aug": "Aug",
								"sep": "Sep",
								"oct": "Oct",
								"nov": "Nov",
								"dec": "Dec",
							},
							"full": {
								"jan": "January",
								"feb": "February",
								"mar": "March",
								"apr": "April",
								"may": "May",
								"jun": "June",
								"jul": "July",
								"aug": "August",
								"sep": "September",
								"oct": "October",
								"nov": "November",
								"dec": "December",
							},
						},

						"weekdays": {
							"short": {
								"su": "Su",
								"mo": "Mo",
								"tu": "Tu",
								"we": "We",
								"th": "Th",
								"fr": "Fr",
								"sa": "Sa",
							},
							"full": {
								"su": "Sunday",
								"mo": "Monday",
								"tu": "Tuesday",
								"we": "Wednesday",
								"th": "Thursday",
								"fr": "Friday",
								"sa": "Saturday",
							},
							"word next": { // The Russian language seems to use other words for next for some weekdays.
								"su": "next",
								"mo": "next",
								"tu": "next",
								"we": "next",
								"th": "next",
								"fr": "next",
								"sa": "next",
							}
						},
						"texts": {
							"open always": "Facility is always open",
							"unknown always": "Facility is always maybe open",
							"closed always": "Facility is always closed",
							"open now": "Facility is now open",
							"unknown now": "Facility might be open now",
							"closed now": "Facility is now closed",
							"will close": "but <a href=\"__href__\">will</a> close __timestring__.",
							"will unknown": "but <a href=\"__href__\">will</a> maybe open __timestring__.",
							"will open": "but <a href=\"__href__\">will</a> open __timestring__.",
							"depends on": ", but that depends on __comment__.",
							"week stable": "Schedule is valid in any given week.",
							"not week stable": "Attention! This schedule might change for other weeks.",
							"value for": "value for",
							"MatchingRule": "Substring used by applied rule",
							"warn error": "Error and warning messages",
							"other implementation": "For more information you can check out the <a href=\"__url__\" target=\"_blank\">original JS implementation</a> written by __by__",
							"the OSM wiki": "the OSM wiki",
							"this website": "This website and the JavaScript library used for the evalutation of opening hours is developed on <a href=\"__url__\" target=\"_blank\">__hoster__</a>.",
						},
						"words": {
							"to": "to",
							"and": "and",
							"no": "no",
							"his": "his",
							"docu": "documentation",
							"of course": "of course",
							"open": "open",
							"unknown": "unknown",
							"closed": "closed",
							"comment": "comment",
							"today": "today",
							"tomorrow": "tomorrow",
							// "on weekday": "on", // not needed in this context
							"on weekday": " ",
							"in duration": "in",
							"region": "region",
							"position": "position",
							"lat": "latitude",
							"lon": "longitude",
							"country": "country",
							"state": "state",
							"status": "status",
							"examples": "Examples",
							"none": "none",
							"date": "date",
							"time": { // __count__ Can not cover need for Russian language (one, several, many).
								"minute": "minute",
								"minute plural": "minutes",
								"minute many": "minutes",
								"hour": "hour",
								"hour plural": "hours",
								"hour many": "hours",
								"day": "day",
								"day plural": "days",
								"day many": "days",
								"hours minutes sep": "and ",
								"now": "now",
								"time": "time",
							},
						},
					},
				},
				de: { translation: {
						"lang": {
							"en": "Englisch",
							"de": "Deutsch",
							"ru": "Russisch",
							"choose": "Wähle eine Sprache",
						},
						"months": {
							"short": {
								"mar": "Mär",
								"may": "Mai",
								"oct": "Okt",
								"dec": "Dez",
							},
							"full": {
								"jan": "Januar",
								"feb": "Februar",
								"mar": "März",
								"may": "Mai",
								"jun": "Juni",
								"jul": "Juli",
								"oct": "Oktober",
								"dec": "Dezember",
							},
						},

						"weekdays": {
							"short": {
								"su": "So",
								"mo": "Mo",
								"tu": "Di",
								"we": "Mi",
								"th": "Do",
								"fr": "Fr",
								"sa": "Sa",
							},
							"full": {
								"su": "Sonntag",
								"mo": "Montag",
								"tu": "Dienstag",
								"we": "Mittwoch",
								"th": "Donnerstag",
								"fr": "Freitag",
								"sa": "Samstag",
							},
							"word next": {
								"su": "nächsten",
								"mo": "nächsten",
								"tu": "nächsten",
								"we": "nächsten",
								"th": "nächsten",
								"fr": "nächsten",
								"sa": "nächsten",
							}
						},
						"texts": {
							"open always": "Die Einrichtung hat immer geöffnet.",
							"unknown always": "Die Öffnungszeit der Einrichtung ist immer unbekannt",
							"closed always": "Die Einrichtung hat nie geöffnet.",
							"open now": "Die Einrichtung hat jetzt geöffnet",
							"unknown now": "Die Einrichtung ist möglicherweise jetzt geöffnet",
							"closed now": "Die Einrichtung ist jetzt geschlossen",
							"will close": "aber <a href=\"__href__\">wird</a> __timestring__ schließen.",
							"will unknown": "aber <a href=\"__href__\">wird</a> eventuell __timestring__ öffnen.",
							"will open": "aber <a href=\"__href__\">wird</a> __timestring__ öffnen.",
							"depends on": ", abhängig von __comment__.",
							"week stable": "Dieser Wochenplan gilt für jede Woche.",
							"not week stable": "Achtung! Dieser Wochenplan kann sich in anderen Wochen ändern.",
							"value for": "Wert für",
							"MatchingRule": "Zur Anwendung gekommene Regel",
							"warn error": "Fehler und Warnungen",
							"other implementation": "Für weitere Informationen kannst dir eine weitere (die erste) <a href=\"__url__\" target=\"_blank\">JS Implementierung</a>, von __by__ anschauen",
							"the OSM wiki": "das OSM wiki",
							"this website": "Die Entwicklung dieser Webseite und der JavaScript Bibliothek zur Auswertung der Öffnungszeiten findet auf <a href=\"__url__\" target=\"_blank\">__hoster__</a> statt.",
						},
						"words": {
							"to": "-",
							"and": "und",
							"no": "kein",
							"his": "seine",
							"docu": "Dokumentation",
							"of course": "natürlich",
							"open": "geöffnet",
							"unknown": "unbekannt",
							"closed": "geschlossen",
							"comment": "Kommentar",
							"today": "heute",
							"tomorrow": "morgen",
							// "on weekday": "on", // not needed in this context
							"on weekday": " ",
							"region": "Region",
							"position": "Position",
							"lat": "Breitengrad",
							"lon": "Längengrad",
							"country": "Land",
							"state": "Bundesstaat",
							"status": "Status",
							"examples": "Beispiele",
							"none": "keine",
							"date": "Datum",
							"time": { // __count__ Can not cover need for Russian language (one, several, many).
								"minute": "Minute",
								"minute plural": "Minuten",
								"minute many": "Minuten",
								"hour": "Stunde",
								"hour plural": "Stunden",
								"hour many": "Stunden",
								"day": "Tag",
								"day plural": "Tage",
								"day many": "Tage",
								"hours minutes sep": "und ",
								"now": "Jetzt",
								"time": "Zeit",
							},
						},
					},
				},
				ru: { translation: {
						"lang": {
							"en": "английский",
							"de": "немецкий",
							"ru": "русский",
							"choose": "Выберите язык",
						},
						"months": {
							"short": {
								"jan": "Янв",
								"feb": "Фев",
								"mar": "Мар",
								"apr": "Апр",
								"may": "Май",
								"jun": "Июн",
								"jul": "Июл",
								"aug": "Авг",
								"sep": "Сен",
								"oct": "Окт",
								"nov": "Ноя",
								"dec": "Дек",
							},
							"full": {
								"jan": "Января",
								"feb": "Февраля",
								"mar": "Марта",
								"apr": "Апреля",
								"may": "Мая",
								"jun": "Июня",
								"jul": "Июля",
								"aug": "Августа",
								"sep": "Сентября",
								"oct": "Октября",
								"nov": "Ноября",
								"dec": "Декабря",
							},
						},
						"weekdays": {
							"short": {
								"su": "Вс",
								"mo": "Пн",
								"tu": "Вт",
								"we": "Ср",
								"th": "Чт",
								"fr": "Пт",
								"sa": "Сб",
							},
							"full": {
								"su": "воскресенье",
								"mo": "понедельник",
								"tu": "вторник",
								"we": "среду",
								"th": "четверг",
								"fr": "пятницу",
								"sa": "субботу",
							},
							"word next": {
								"su": "ближайшее",
								"mo": "ближайший",
								"tu": "ближайший",
								"we": "ближайшую",
								"th": "ближайший",
								"fr": "ближайшую",
								"sa": "ближайшую",
							},
						},
						"texts": {
							"open always": "Заведение всегда открыто.",
							"closed always": "Заведение всегда закрыто.",
							"open now": "Сейчас заведение открыто",
							"closed now": "Сейчас заведение закрыто",
							"will close": "<a href=\"__href__\">Закроется</a> __timestring__.",
							"will open": "<a href=\"__href__\">Откроется</a> __timestring__.",
							"week stable": "Расписание верно для любой недели.",
							"not week stable": "ВНИМАНИЕ! Расписание меняется в другие недели.",
							"value for": "значение для",
							"MatchingRule": "использовать правила",
							"warn error": "об ошибках и предупреждения",
						},
						"words": {
							"to": "до",
							"and": "и",
							"no": "Нет",
							"open": "c",
							"unknown": "неизвестный",
							"closed": "закрыто",
							"comment": "комментариев",
							"today": "сегодня",
							"tomorrow": "завтра",
							"on weekday": "в ", // optionally in other languages
							"in duration": "через",
							"region": "регион",
							"position": "положение",
							"lat": "широта",
							"lon": "долгота",
							"country": "страна",
							"state": "штат",
							"status": "статус",
							"examples": "примеры",
							"date": "дата",
							"none": "никто",
							"time": {
								"minute": "минуту",
								"minute plural": "минуты",
								"minute many": "минут",
								"hour": "час",
								"hour plural": "часа",
								"hour many": "часов",
								"day": "день",
								"day plural": "дня",
								"day many": "дней",
								"now": "сейчас",
								"time": "время",
							},
						},
					},
				},
			};

			function translatePage() { // Gets called when localization is loaded.
				// $(".lang").i18n();
				// $("headline").i18n();
			}

			i18n.init({
					fallbackLng: 'en',
					resStore: resources,
					getAsync: true,
					useCookie: true,
					debug: true
				}, translatePage);
			// }}}
			// JS functions for gernerating the table {{{
			// In English. Localization is done somewhere else (above).
			var months   = ['jan','feb','mar','apr','may','jun','jul','aug','sep','oct','nov','dec'];
			var weekdays = ['su','mo','tu','we','th','fr','sa'];

			function formatdate(now, nextchange, from) {
				var now_daystart = new Date(now.getFullYear(), now.getMonth(), now.getDate());
				var nextdays = (nextchange.getTime() - now_daystart.getTime()) / 1000 / 60 / 60 / 24;

				var timediff = '';

				var delta = Math.floor((nextchange.getTime() - now.getTime()) / 1000 / 60); // delta is minutes
				if (delta < 60)
					timediff = i18n.t("words.in duration") +' '+ delta + ' ' + plural(delta, 'words.time.minute');

				var deltaminutes = delta % 60;
				delta = Math.floor(delta / 60); // delta is now hours

				if (delta < 48 && timediff == '')
					timediff = i18n.t("words.in duration") +' '+ delta + ' ' + plural(delta, 'words.time.hour')
						+' '+ i18n.t('words.time.hours minutes sep') + pad(deltaminutes) + ' ' + plural(deltaminutes, 'words.time.minute');

				var deltahours = delta % 24;
				delta = Math.floor(delta / 24); // delta is now days

				if (delta < 14 && timediff == '')
					timediff = i18n.t("words.in duration") +' '+ delta + ' ' + plural(delta, 'words.time.day')
						+ ' ' + deltahours + ' ' + plural(deltahours, 'words.time.hour')
				else if (timediff == '')
					timediff = i18n.t("words.in duration") +' '+ delta + ' ' + plural(delta, 'words.time.day');

				var atday = '';
				if (from ? (nextdays < 1) : (nextdays <= 1))
					atday = i18n.t('words.today');
				else if (from ? (nextdays < 2) : (nextdays <= 2))
					atday = i18n.t('words.tomorrow');
				else if (from ? (nextdays < 7) : (nextdays <= 7))
					atday = i18n.t('words.on weekday') + i18n.t('weekdays.word next.' + weekdays[nextchange.getDay()])
						+' '+ i18n.t('weekdays.full.' + weekdays[nextchange.getDay()]);

				var atdate = nextchange.getDate() + ' ' + i18n.t('months.full.' + months[nextchange.getMonth()]);

				var res = [];

				if (atday != '') res.push(atday);
				if (atdate != '') res.push(atdate);
				if (timediff != '') res.push(timediff);

				return res.join(', ');
			}

			function pad(n) { return n < 10 ? '0'+n : n; };

			function plural(n, trans_base) {
				if (n % 10 >= 5 || n % 10 == 0 || (n % 100 >= 10 && n % 100 < 20)) {
					return i18n.t(trans_base + ' many');
				} else if (n % 10 < 2) {
					return i18n.t(trans_base); // singular form
				}
				return i18n.t(trans_base + ' plural');
			}

			function printDate(date) {
					return i18n.t('months.short.' + months[date.getMonth()]) + ' ' +
						date.getDate() + ', ' + i18n.t('weekdays.short.' + weekdays[date.getDay()]);
			}

			function drawTable(it, date_today, has_next_change) {
				var date_today = new Date(date_today);
				date_today.setHours(0, 0, 0, 0);

				var date = new Date(date_today);
				// date.setDate(date.getDate() - date.getDay() + 7);
				date.setDate(date.getDate() - date.getDay() - 1); // start at begin of the week

				var table = [];

				for (var row = 0; row < 7; row++) {
					date.setDate(date.getDate()+1);
					// if (date.getDay() == date_today.getDay()) {
					// 	date.setDate(date.getDate()-7);
					// }

					it.setDate(date);
					var is_open      = it.getState();
					var unknown      = it.getUnknown();
					var state_string = it.getStateString(false);
					var prevdate = date;
					var curdate  = date;

					table[row] = {
						date: new Date(date),
						times: '',
						text: []
					};

					while (has_next_change && it.advance() && curdate.getTime() - date.getTime() < 24*60*60*1000) {
						curdate = it.getDate();

						var fr = prevdate.getTime() - date.getTime();
						var to = curdate.getTime() - date.getTime();

						if (to > 24*60*60*1000)
							to = 24*60*60*1000;

						fr *= 100/1000/60/60/24;
						to *= 100/1000/60/60/24;

						table[row].times += '<div class="timebar ' + (is_open ? 'open' : (unknown ? 'unknown' : 'closed'))
							+ '" style="width:' + (to-fr) + '%"></div>';
						if (is_open || unknown) {
							var text = i18n.t('words.' + state_string) + ' ' + prevdate.getHours() + ':' + pad(prevdate.getMinutes())
								+ ' ' + i18n.t('words.to') + ' ';
							if (prevdate.getDay() != curdate.getDay())
								text += '24:00';
							else
								text += curdate.getHours() + ':' + pad(curdate.getMinutes());

							table[row].text.push(text);
						}

						prevdate = curdate;
						is_open      = it.getState();
						unknown      = it.getUnknown();
						state_string = it.getStateString(false);
					}

					if (!has_next_change && table[row].text.length == 0) { // 24/7
						table[row].times += '<div class="timebar ' + (is_open ? 'open' : (unknown ? 'unknown' : 'closed'))
							+ '" style="width:100%"></div>';
						table[row].text.push(i18n.t('words.open') + ' 00:00 ' + i18n.t('words.to') + '23:59');
					}
				}

				var output = '';
				output += '<table>';
				for (var row in table) {
					var today = table[row].date.getDay() == date_today.getDay();
					var endweek = ((table[row].date.getDay() + 1) % 7) == date_today.getDay();
					var cl = today ? ' class="today"' : (endweek ? ' class="endweek"' : '');

					// if (today && date_today.getDay() != 1)
					// 	output += '<tr class="separator"><td colspan="3"></td></tr>';
					output += '<tr' + cl + '><td class="day ' + (table[row].date.getDay() % 6 == 0 ? 'weekend' : 'workday') + '">';
					output += printDate(table[row].date);
					output += '</td><td class="times">';
					output += table[row].times;
					output += '</td><td>';
					output += table[row].text.join(', ') || '&nbsp;';
					output += '</td></tr>';
				}
				output += '</table>';
				return output;
			}

			function getReadableState(startString, endString, oh, past) {
				if (past === true) past = 'd';
				else past = '';

				var output = '';
				return startString + output + endString + '.';
			}

			function drawTableAndComments(oh, it) {
				var prevdate          = it.getDate();
				var is_open           = it.getState();
				var unknown           = it.getUnknown();
				var state_string      = it.getStateString(false);
				var state_string_past = it.getStateString(true);
				var comment           = it.getComment();
				var has_next_change   = it.advance();

				var output = '';

				output += '<p class="' + state_string_past + '">'
					+ i18n.t('texts.' + state_string_past+ ' ' + (has_next_change ? 'now' : 'always'));
				if (unknown) {
					output += (comment ? i18n.t('texts.depends on', { comment: '"' + comment + '"' }) : '');
				} else {
					output += (comment ? ', ' + i18n.t('words.comment') + ': "' + comment + '"' : '');
				}
				output += '</p>';

				if (has_next_change) {
					var time_diff = it.getDate().getTime() - prevdate.getTime();
					time_diff = (time_diff) / 1000;
					time_diff += 1; // go one 1/60 second after
					output += '<p class="' + it.getStateString(true) + '">'
						+ i18n.t('texts.will ' + it.getStateString(false), {
							timestring: formatdate(prevdate, it.getDate(), true),
							href: 'javascript:Evaluate(' + time_diff + ')',
						}) + '</p>';
				}

				output += drawTable(it, prevdate, has_next_change);

				if (oh.isWeekStable())
					output += '<p><b>'+ i18n.t('texts.week stable') +'</b></p>';
				else
					output += '<p><b>'+ i18n.t('texts.not week stable') +'</b></p>';

				return output;
			}
			// }}}
		</script>
		<!-- }}} -->
	</head> <!-- }}} -->
    <body><!-- {{{ -->
		<script type="text/javascript">
			<!-- Choose language {{{ -->
			document.write(i18n.t('lang.choose')
					+ (i18n.lng() !== 'en' ? ' ('+ i18n.t('lang.choose', { lng: 'en' }) +')' : '' )
					+ ': ');
				for (var lang in resources) {
					if (resources.hasOwnProperty(lang)) {
					  document.write('<button type="button" onclick="location.href=\'?setLng='
							+ lang +'\'">' + i18n.t('lang.' + lang)
							+ (i18n.lng() !== 'en' ? ' ('+ i18n.t('lang.' +lang, { lng: 'en' }) +')' : '' )
							+ '</button>');
					}
				}
			<!-- }}} -->
		</script>

		<div id="user"><!-- {{{ -->
			<!-- JS for user testing stuff {{{ -->
			<script type="text/javascript">
			/*<![CDATA[*/

			var lat, lon, nominatim;
			var url_lang = 'en';

			function Evaluate (offset, reset) {
				if (typeof offset == 'undefined') offset = 0;

				document.forms.check.elements['comment'].value = '';
				document.forms.check.elements['status'].value = '';
				document.forms.check.elements['MatchingRule'].value = '';
				document.forms.check.elements['WarnErrors'].value = '';

				if (document.forms.check.elements['lat'].value !== lat || document.forms.check.elements['lon'].value !== lon) {
					lat = document.forms.check.elements['lat'].value;
					lon = document.forms.check.elements['lon'].value;
					// var url = 'http://nominatim.openstreetmap.org/reverse';
					var url = 'http://open.mapquestapi.com/nominatim/v1/reverse.php';
					url += '?format=json&lat=' + lat + '&lon=' + lon
						+ '&zoom=18&addressdetails=1&email=ypid23@aol.de';
					var url_lang_set = 'accept-language=';

					var xhr = new XMLHttpRequest();
					xhr.open( "GET", url + '&' + url_lang_set + url_lang, true );      // true makes this call asynchronous
					xhr.onreadystatechange = function () {    // need eventhandler since our call is async
						if ( xhr.readyState == 4 && xhr.status == 200 ) {  // check for success
							nominatim = JSON.parse( xhr.responseText );
							// console.log(JSON.stringify(nominatim, null, '\t'));

							if (nominatim.address.country_code != url_lang) {
								xhr.open( "GET", url + '&' + url_lang_set + nominatim.address.country_code, true );
								xhr.onreadystatechange = function () {
									if ( xhr.readyState == 4 && xhr.status == 200 ) {  // check for success
										nominatim = JSON.parse( xhr.responseText );
									}
									url_lang = nominatim.address.country_code;
									document.forms.check.elements['cc'].value    = nominatim.address.country_code;
									document.forms.check.elements['state'].value = nominatim.address.state;
									Evaluate();
								}
								xhr.send(null);
							} else {
								document.forms.check.elements['cc'].value    = nominatim.address.country_code;
								document.forms.check.elements['state'].value = nominatim.address.state;
								Evaluate();
							}
						}
					};
					xhr.send(null);
				}

				date = reset ? new Date() : new Date(
						document.forms.check.elements['yyyy'].value,
						document.forms.check.elements['mm'].selectedIndex,
						document.forms.check.elements['dd'].value,
						document.forms.check.elements['HH'].value,
						parseInt(document.forms.check.elements['MM'].value),
						offset
					);

				function u2 (v) { return v>=0 && v<10 ? "0"+v : v; }

				document.forms.check.elements['yyyy'].value = date.getFullYear();
				document.forms.check.elements['mm'].selectedIndex = date.getMonth();
				document.forms.check.elements['dd'].value = u2(date.getDate());
				document.forms.check.elements['HH'].value = u2(date.getHours());
				document.forms.check.elements['MM'].value = u2(date.getMinutes());
				document.forms.check.elements['wday'].value = i18n.t('weekdays.full.' + weekdays[date.getDay()]);
				// document.forms.check.elements['week'].value = 'W'+u2();

				var user_evaluation = document.getElementById('user_evaluation');

				var crashed = false;
				try {
					var oh = new opening_hours(document.forms.check.elements['expression'].value, nominatim);
					var it = oh.getIterator(date);
				} catch (err) {
					crashed = err;
					document.forms.check.elements['WarnErrors'].value = crashed;
					user_evaluation.innerHTML = '';
				}

				if (!crashed) {
					document.forms.check.elements['comment'].value = typeof it.getComment() != 'undefined'
						? it.getComment() : '>>' + i18n.t('words.no') + ' ' + i18n.t('words.comment') + '<<';
					document.forms.check.elements['status'].value = (it.getState() ? i18n.t('words.open')
						: (it.getUnknown() ? i18n.t('words.unknown') : i18n.t('words.closed')));
					document.forms.check.elements['MatchingRule'].value = typeof it.getMatchingRule() == 'undefined'
						? i18n.t('words.none') : it.getMatchingRule();
					document.forms.check.elements['WarnErrors'].value = oh.getWarnings();

					user_evaluation.innerHTML = drawTableAndComments(oh, it);
				}
			}

			function EX (element) {
				document.forms.check.elements['expression'].value=element.innerHTML;
				Evaluate();
				return false;
			}

			function permalink () {
				var mmsel = document.getElementById('mm');

				var yyyymmdd =	document.getElementById('yyyy').value +
						mmsel.options[+mmsel.selectedIndex].value +
						document.getElementById('dd').value;
				var exp =	document.getElementById('expression').value;

				var search='?EXP='+encodeURIComponent(exp)+'&DATE='+encodeURIComponent(yyyymmdd);

				location = location.protocol+'//'+location.host+location.pathname+search;
			}

			function onPositionUpdate(position) {
				var lat = position.coords.latitude;
				var lng = position.coords.longitude;
				console.log("Current position: " + lat + " " + lng);
			}
			window.onload = function () {Evaluate();
			// if(navigator.geolocation)
			// 	navigator.geolocation.getCurrentPosition(onPositionUpdate);
			};

			/*]]>*/</script>
			<!-- }}} -->

			<form id="check" action="#">
				<!-- User input {{{ -->
				<p>
					<script type="text/javascript">
					var buttons = [
						[ 3600 * 24, 1, 'words.time.day'    ],
						[ 3600     , 1, 'words.time.hour'   ],
						[ 60       , 1, 'words.time.minute' ],
						[ 0        , 0, 'words.time.now'    ],
					];
					for (var i = 0; i < buttons.length; i++) {
						if (buttons[i][1] != 0) {
							for (var x = -1; x <= 1; x += 2) {
								var step = x * buttons[i][1]
								document.write('<button type="button" onclick="Evaluate(' + buttons[i][0] * step
									+ ')">' + (step > 0 ? '+' : '') + step + ' ' + i18n.t(buttons[i][2]) + '</button> ');
							}
						} else {
							document.write('<button type="button" onclick="Evaluate(0, true'
								+ ')">' + i18n.t(buttons[i][2]) + '</button> ');
						}
					}
					</script>
				</p>

				<p>
					<script type="text/javascript">
						document.write(i18n.t('words.date') + ' ' + i18n.t('words.and') + ' ' + i18n.t('words.time.time') + ':<br />');
						document.write('<input id="dd" size="3" name="dd" value="02" onblur="Evaluate()"/>.');
						document.write('<select id="mm" name="mm" onchange="Evaluate()">');
						for (var i = 0; i < months.length; i++) {
							document.write('<option value="' + i + 1 + '">' + i18n.t('months.full.' + months[i]) + '</option>');
						}
						document.write('</select>');
					</script>

					<input id="yyyy" size="5" name="yyyy" value="2013" onblur="Evaluate()" />
					&#160;
					<input size="3" name="HH" value="22" onblur="Evaluate()" />:<input size="3" name="MM" value="21" onblur="Evaluate()" />
					&#160;
					<input size="10" name="wday" readonly="readonly" />
					<input size="7" name="week" readonly="readonly" />
					<script type="text/javascript">
						document.write(i18n.t('words.position') + ': ');
						document.write(i18n.t('words.lat') + ': <input size="7" id="lat" value="53.1035" onblur="Evaluate()" /> ');
						document.write(i18n.t('words.lon') + ': <input size="7" id="lon" value="8.8976"  onblur="Evaluate()" /> ');
						document.write(i18n.t('words.country') + ': <input size="3" id="cc" readonly="readonly" /> ');
						document.write(i18n.t('words.state') + ': <input size="20" id="state" readonly="readonly" />');
					</script>
				</p>

				<p>
					<script type="text/javascript">
						document.write(i18n.t('texts.value for') + ' <q>opening_hours</q>:<br />');
						function submitenter(myfield,e) {
							var keycode;
							if (window.event) keycode = window.event.keyCode;
							else if (e) keycode = e.which;
							else return true;

							if (keycode == 13) {
								Evaluate();
								return false;
							} else
								return true;
						}
					</script>
					<input id="expression" onKeyPress="return submitenter(this,event)" style="width:100%" name="expression" value="Mo-Fr 10:00-20:00" onblur="Evaluate()" />
				</p>
				<!-- }}} -->

				<div id="user_evaluation"><!-- {{{ -->
				</div><!-- }}} -->

				<!-- Display results {{{ -->
				<p>
					<script type="text/javascript">document.write(i18n.t('words.status') + ':<br />');</script>
					<input size="10" name="status" readonly="readonly" />
					<input size="60" name="comment" readonly="readonly" />
				</p>

				<p>
					<script type="text/javascript">document.write(i18n.t('texts.MatchingRule') + ':<br />');</script>
					<input style="width: 100%" name="MatchingRule" readonly="readonly" />
				</p>

				<p>
					<script type="text/javascript">document.write(i18n.t('texts.warn error') + ':<br />');</script>
					<textarea rows="5" style="width: 100%" name="WarnErrors" readonly="readonly"></textarea><br />
				</p>
				<!-- }}} -->
			</form>

			<p style="text-align: right">
			<a href="#" onclick="permalink();return false">permalink</a>
			</p>

			<hr /><!-- Examples {{{ -->
			<script type="text/javascript">document.write('<a href="javascript:toggle(\'user_examples\')"><h2 id="examples">'
				+ i18n.t('words.examples') + ':</h2></a>');</script>
			<!-- JS for toggeling exampes on and off {{{ -->
			<script type="text/javascript">
				function toggle(control){
					var elem = document.getElementById(control);

					if(elem.style.display == "none"){
						elem.style.display = "block";
					}else{
						elem.style.display = "none";
					}
				}
			</script>
			<!-- }}} -->
			<div id="user_examples"><!-- {{{ -->
				<ol>
					<li><a href="#check" onclick="EX(this)">Mo-Fr 10:00-20:00</a></li>
					<li><a href="#check" onclick="EX(this)">Mo,Tu,Th,Fr 12:00-18:00; Sa 12:00-17:00; Th[3] off; Th[-1] off</a></li>
					<li><a href="#check" onclick="EX(this)">00:00-24:00; Tu-Su 08:30-09:00 off; Tu-Su 14:00-14:30 off; Mo 08:00-13:00 off</a></li>
					<li><a href="#check" onclick="EX(this)">Fr-Sa 18:00-06:00</a></li>
					<li><a href="#check" onclick="EX(this)">24/7</a></li>
					<li><a href="#check" onclick="EX(this)">"only after registration"</a></li>
					<li><a href="#check" onclick="EX(this)">22:00-23:00</a></li>
					<li><a href="#check" onclick="EX(this)">08:00-11:00</a></li>
					<li><a href="#check" onclick="EX(this)">Mo-Su 22:00-23:00; We closed</a></li>
					<li><a href="#check" onclick="EX(this)">Mo-Fr 08:00-11:00 || Tu-Th 22:00-23:00 open "Emergency only"</a></li>
					<li><a href="#check" onclick="EX(this)">Tu-Th, We 22:00-23:00 open "Hot meals"</a></li>
					<li><a href="#check" onclick="EX(this)">Oct: 22:00-23:00</a></li>
					<li><a href="#check" onclick="EX(this)">Apr: 22:00-23:00</a></li>
					<li><a href="#check" onclick="EX(this)">Jul-Jan: 22:00-23:00</a></li>
					<li><a href="#check" onclick="EX(this)">Jan-Jul: 22:00-23:00</a></li>
					<li><a href="#check" onclick="EX(this)">Jul 23 - Jan 03: "needs reservation by phone"</a></li>
					<li><a href="#check" onclick="EX(this)">Jul 23 - Jan 03: 22:00-23:00 "Please make an reservation by phone."</a></li>
					<li><a href="#check" onclick="EX(this)">Jul 23 - Jan 03: 08:00-11:00 "Please make an reservation by phone."</a></li>
					<li><a href="#check" onclick="EX(this)">Jan 23 - Jul 03: 22:00-23:00 "Please make an reservation by phone."</a></li>
					<!-- <li><a href="#check" onclick="EX(this)">Mar Su[&#45;1] &#45; Dec 25&#45;Su&#45;28 days: 22:00&#45;23:00</a></li> -->
					<!-- <li><a href="#check" onclick="EX(this)">Dec 25&#45;Su&#45;28 days &#45; Mar Su[&#45;1]: 22:00&#45;23:00</a></li> -->
					<!-- Currently used around 6 times: /\d\s*&#45;\s*(mo|tu|we|th|fr|sa|su)\b/ -->
					<li><a href="#check" onclick="EX(this)">Sa[-1],Sa[-1] +1 day 10:00-12:00 open "last weekend in the month"</a></li>
					<li><a href="#check" onclick="EX(this)">Sa-Su 00:00-24:00</a></li>
					<li><a href="#check" onclick="EX(this)">Mo-Fr 00:00-24:00</a></li>
					<li><a href="#check" onclick="EX(this)">sunrise-sunset closed "Beware of sunburn!"</a></li>
					<li><a href="#check" onclick="EX(this)">sunset-sunrise open "Beware of vampires!"</a></li>
					<li><a href="#check" onclick="EX(this)">(sunset+1:00)-24:00 || closed "No drink before sunset!"</a></li>
					<li><a href="#check" onclick="EX(this)">22:00+</a></li>
					<!-- <li><a href="#check" onclick="EX(this)">&#45;23:00</a></li> -->
					<li><a href="#check" onclick="EX(this)">Tu 23:59-22:59</a></li>
					<li><a href="#check" onclick="EX(this)">We-Mo 23:59-22:59</a></li>
					<li><a href="#check" onclick="EX(this)">week 2-52/2 We, week 1-53/2 Sa 0:00-24:00</a></li>
					<li><a href="#check" onclick="EX(this)">week 4-16 We, week 38-42 Sa 0:00-24:00</a></li>
					<li><a href="#check" onclick="EX(this)">2012 easter - 2 days - 2012 easter + 2 days: open "Around easter"</a></li>
					<li>
						<a href="#check" onclick="EX(this)">2013,2015,2050-2053,2055/2,2020-2029/3,2060/1 Jan 1</a>,
						<a href="https://github.com/AMDmi3/opening_hours.js/tree/master#year-ranges" target="_blank">Documentation</a>
					</li>
					<li><a href="#check" onclick="EX(this)">Jan 23-Feb 11,Feb 12 00:00-24:00</a></li>
					<li><a href="#check" onclick="EX(this)">Apr-Oct: Su[2] 14:00-18:00; Aug Su[-1] -1 day 10:00-18:00; Aug Su[-1]: 10:00-18:00</a></li>
					<li><a href="#check" onclick="EX(this)">Su-Tu 11:00-01:00, We-Th 11:00-03:00, Fr 11:00-06:00, Sa 11:00-07:00</a></li>
				</ol>

				<ol>
					<li value="36"><a href="#check" onclick="EX(this)">We</a></li>
					<li><a href="#check" onclick="EX(this)">PH</a></li>
					<li><a href="#check" onclick="EX(this)">PH Mo-Fr</a> (Only if PH is from Mo till Fr)</li>
					<li><a href="#check" onclick="EX(this)">PH -1 day</a></li>
					<li><a href="#check" onclick="EX(this)">SH</a></li>
					<li><a href="#check" onclick="EX(this)">SH,PH</a></li>
					<li><a href="#check" onclick="EX(this)">PH,SH</a> (This makes a small difference compared to the privours value. The name of the school holidays will override the PH names in the comment.)</li>
					<li><a href="#check" onclick="EX(this)">We[1-3]</a></li>
					<li><a href="#check" onclick="EX(this)">We[3-5]</a></li>
					<li><a href="#check" onclick="EX(this)">Sa</a></li>
					<li><a href="#check" onclick="EX(this)">Sa[1]</a></li>
					<li><a href="#check" onclick="EX(this)">Sa[1-3]</a></li>
					<li><a href="#check" onclick="EX(this)">Tu-Th</a></li>
					<li><a href="#check" onclick="EX(this)">Fr-Mo</a></li>
					<li><a href="#check" onclick="EX(this)">Mo-Su; We "only after registration"</a></li>
					<li><a href="#check" onclick="EX(this)">Oct: We[1]</a></li>
				</ol> <!-- }}} -->
			</div><!-- }}} -->

		<script type="text/javascript">
		  document.write(i18n.t('texts.other implementation', { by: 'Netzwolf', url: 'http://www.netzwolf.info/en/cartography/osm/time_domain/form_hours' }));
			document.write(', '
				+ ' <a href="http://www.netzwolf.info/en/cartography/osm/time_domain/" target="_blank">'
				+ i18n.t('words.his') + ' ' + i18n.t('words.docu') + '</a>');
			document.write(' ' + i18n.t('words.and') + ' ' + i18n.t('words.of course') + ' '
				+ '<a href="http://wiki.openstreetmap.org/wiki/Key:opening_hours" target="_blank">'
				+ i18n.t('texts.the OSM wiki') + '</a>.<br />');

			document.write(i18n.t('texts.this website', { url: 'https://github.com/AMDmi3/opening_hours.js', hoster: 'GitHub' }));
	  </script>
		</div><!-- }}} -->
	</body><!-- }}} -->
</html>
